!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n=e();for(var r in n)("object"==typeof exports?exports:t)[r]=n[r]}}(self,(function(){return(()=>{"use strict";var t={14:(t,e,n)=>{t.exports=n.p+"83811d7190b85384cff4.js"}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var i=e[r]={exports:{}};return t[r](i,i.exports,n),i.exports}return n.p="/includes/",(()=>{var t=n(14);function e(t){var e=t((function(t){Error.call(t),t.stack=(new Error).stack}));return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var r=e((function(t){return function(){t(this),this.name="EmptyError",this.message="no elements in sequence"}})),o=function(t,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},o(t,e)};function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function a(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function s(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}function u(t,e){for(var n=0,r=e.length,o=t.length;n<r;n++,o++)t[o]=e[n];return t}function c(t){return"function"==typeof t}Object.create,Object.create;var f=e((function(t){return function(e){t(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}}));function l(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var p=function(){function t(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._teardowns=null}var e;return t.prototype.unsubscribe=function(){var t,e,n,r,o;if(!this.closed){this.closed=!0;var i=this._parentage;if(i)if(this._parentage=null,Array.isArray(i))try{for(var l=a(i),p=l.next();!p.done;p=l.next())p.value.remove(this)}catch(e){t={error:e}}finally{try{p&&!p.done&&(e=l.return)&&e.call(l)}finally{if(t)throw t.error}}else i.remove(this);var h=this.initialTeardown;if(c(h))try{h()}catch(t){o=t instanceof f?t.errors:[t]}var m=this._teardowns;if(m){this._teardowns=null;try{for(var v=a(m),y=v.next();!y.done;y=v.next()){var b=y.value;try{d(b)}catch(t){o=null!=o?o:[],t instanceof f?o=u(u([],s(o)),s(t.errors)):o.push(t)}}}catch(t){n={error:t}}finally{try{y&&!y.done&&(r=v.return)&&r.call(v)}finally{if(n)throw n.error}}}if(o)throw new f(o)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)d(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._teardowns=null!==(n=this._teardowns)&&void 0!==n?n:[]).push(e)}},t.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},t.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},t.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&l(e,t)},t.prototype.remove=function(e){var n=this._teardowns;n&&l(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=((e=new t).closed=!0,e),t}();function d(t){c(t)?t():t.unsubscribe()}p.EMPTY;var h={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},m={setTimeout:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=m.delegate;return((null==n?void 0:n.setTimeout)||setTimeout).apply(void 0,u([],s(t)))},clearTimeout:function(t){var e=m.delegate;return((null==e?void 0:e.clearTimeout)||clearTimeout)(t)},delegate:void 0};function v(){}var y=b("C",void 0,void 0);function b(t,e,n){return{kind:t,value:e,error:n}}var g=null,w=function(t){function e(e){var n,r=t.call(this)||this;return r.isStopped=!1,e?(r.destination=e,((n=e)instanceof p||n&&"closed"in n&&c(n.remove)&&c(n.add)&&c(n.unsubscribe))&&e.add(r)):r.destination=k,r}return i(e,t),e.create=function(t,e,n){return new E(t,e,n)},e.prototype.next=function(t){this.isStopped?x(function(t){return b("N",t,void 0)}(t),this):this._next(t)},e.prototype.error=function(t){this.isStopped?x(b("E",void 0,t),this):(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped?x(y,this):(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(p),E=function(t){function e(e,n,r){var o,i=t.call(this)||this;if(c(e))o=e;else if(e){var a;o=e.next,n=e.error,r=e.complete,i&&h.useDeprecatedNextContext?(a=Object.create(e)).unsubscribe=function(){return i.unsubscribe()}:a=e,o=null==o?void 0:o.bind(a),n=null==n?void 0:n.bind(a),r=null==r?void 0:r.bind(a)}return i.destination={next:o?S(o):v,error:S(null!=n?n:_),complete:r?S(r):v},i}return i(e,t),e}(w);function S(t,e){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{t.apply(void 0,u([],s(e)))}catch(t){h.useDeprecatedSynchronousErrorHandling?function(t){h.useDeprecatedSynchronousErrorHandling&&g&&(g.errorThrown=!0,g.error=t)}(t):function(t){m.setTimeout((function(){var e=h.onUnhandledError;if(!e)throw t;e(t)}))}(t)}}}function _(t){throw t}function x(t,e){var n=h.onStoppedNotification;n&&m.setTimeout((function(){return n(t,e)}))}var k={closed:!0,next:v,error:_,complete:v};function T(t){return function(e){if(function(t){return c(null==t?void 0:t.lift)}(e))return e.lift((function(e){try{return t(e,this)}catch(t){this.error(t)}}));throw new TypeError("Unable to lift unknown Observable type")}}var A=function(t){function e(e,n,r,o,i){var a=t.call(this,e)||this;return a.onFinalize=i,a._next=n?function(t){try{n(t)}catch(t){e.error(t)}}:t.prototype._next,a._error=o?function(t){try{o(t)}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._error,a._complete=r?function(){try{r()}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._complete,a}return i(e,t),e.prototype.unsubscribe=function(){var e,n=this.closed;t.prototype.unsubscribe.call(this),!n&&(null===(e=this.onFinalize)||void 0===e||e.call(this))},e}(w);var F,M=function(t,e){return t.push(e),t},P=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}))},C=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},O=function(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))};function j(t){if(t.startsWith("h264"))return{ffmpegFormat:"mp4",mime:'video/mp4; codecs="avc1.640033'};if(t.startsWith("flac"))return{ffmpegFormat:"mp4",mime:'audio/mp4; codecs="flac"'};if(t.startsWith("mp3"))return{ffmpegFormat:"mp4",mime:'audio/mp4; codecs="mp3"'};if(t.startsWith("vorbis"))return{ffmpegFormat:"webm",mime:'audio/webm; codecs="vorbis"'};if(t.startsWith("aac"))return{ffmpegFormat:"mp4",mime:'audio/mp4; codecs="mp4a.40.2"'};if(t.startsWith("opus"))return{ffmpegFormat:"webm",mime:'audio/webm; codecs="opus"'};throw new Error("Unsupported ffmpeg format description: "+t)}self.importScripts(t),function(t){t[t.Uninitialized=1]="Uninitialized",t[t.Initializing=2]="Initializing",t[t.Idle=3]="Idle",t[t.Busy=4]="Busy"}(F||(F={}));var N=function(){function e(){this.outputDir="/output",this.ffmpegState=F.Uninitialized,this.buf=new Uint8Array}return e.prototype.assertState=function(t){if(this.ffmpegState!=t)throw new Error("Expected state "+t+" but current state is "+this.ffmpegState)},e.prototype.isLoaded=function(){return!(this.ffmpegState==F.Uninitialized)},e.prototype.consumeMetadata=function(){return P(this,void 0,void 0,(function(){var t,n,o,i,a,s,u,c,f,l,p,d,h;return C(this,(function(m){switch(m.label){case 0:return v=this.ffmpegLogObservable.pipe((y=function(t){return"FFMPEG_END"!==t},void 0===b&&(b=!1),T((function(t,e){t.subscribe(new A(e,(function(t){var n=y(t);(n||b)&&e.next(t),!n&&e.complete()})))}))),T((function(t,e){(function(t,e){return T(function(t,e,n,r,o){return function(r,o){var i=n,a=e,s=0;r.subscribe(new A(o,(function(e){var n=s++;a=i?t(a,e,n):(i=!0,e)}),(function(){i&&o.next(a),o.complete()})))}}(t,e,arguments.length>=2))})(M,[])(t).subscribe(e)}))),t=new Promise((function(t,e){var n=new E({next:function(e){t(e),n.unsubscribe()},error:e,complete:function(){e(new r)}});v.subscribe(n)})),[4,this.runFFmpeg("-i","input.mkv")];case 1:return m.sent(),[4,t];case 2:for(n=m.sent(),this.inputMetadata={durationSeconds:void 0,audioStreams:[],videoStreams:[],subtitleTracks:[],attachments:[]},o=0,i=n;o<i.length;o++)if(a=i[o],(s=a.match(e.durationRegex))&&(this.inputMetadata.durationSeconds=parseFloat(s[3])+60*parseInt(s[2])+3600*parseInt(s[1])),u=e.streamRegex.exec(a))switch(c=u.groups,f=c.id,l=c.lang,p=c.type,d=c.formatDescription,h={id:f,lang:l,formatDescription:d},p){case"Audio":this.inputMetadata.audioStreams.push(h);break;case"Video":this.inputMetadata.videoStreams.push(h);break;case"Subtitle":this.inputMetadata.subtitleTracks.push(h);break;case"Attachment":this.inputMetadata.attachments.push(h);break;default:console.warn("Ignoring non-audio/video stream",p,h)}return[2]}var v,y,b}))}))},e.prototype.reset=function(){return P(this,void 0,void 0,(function(){return C(this,(function(t){return this.buf=new Uint8Array,[2]}))}))},e.prototype.writeData=function(t,e){return P(this,void 0,void 0,(function(){var n;return C(this,(function(r){return e+t.length>this.buf.length&&((n=new Uint8Array(e+t.length)).set(this.buf),this.buf=n),this.buf.set(t,e),[2,this.buf]}))}))},e.prototype.getInputData=function(){return P(this,void 0,void 0,(function(){return C(this,(function(t){return[2,this.buf]}))}))},e.prototype.getMetadata=function(){return P(this,void 0,void 0,(function(){return C(this,(function(t){return[2,this.inputMetadata]}))}))},e.prototype.remuxChunk=function(t,e,n,r){return void 0===t&&(t=0),P(this,void 0,void 0,(function(){var o,i,a,s,u,c,f,l,p,d;return C(this,(function(h){switch(h.label){case 0:if(0==(o=this.inputMetadata.videoStreams.filter((function(t){return t.id==n}))).length)throw Error("No video stream found with id "+n);if(i=o[0],a=j(i.formatDescription),null!=r){if(0==(c=this.inputMetadata.audioStreams.filter((function(t){return t.id==r}))).length)throw Error("No audio stream found with id "+r);s=c[0],u=j(s.formatDescription)}return f=O(O(["-ss",t.toString()],void 0===e||e==t?[]:["-to",e.toString()],!0),["-copyts","-i","input.mkv"],!1),a&&(f=f.concat(["-map",i.id,"-f",a.ffmpegFormat,"-vcodec","copy","-movflags","frag_keyframe+delay_moov+default_base_moof","video"])),u&&(f=f.concat(["-map",s.id,"-strict","-2","-f",u.ffmpegFormat,"-acodec","copy","-movflags","frag_keyframe+delay_moov+default_base_moof","audio"])),[4,this.runFFmpeg.apply(this,f)];case 1:return h.sent(),l=this.ffmpegCore.FS,p=null,d=null,a&&(p={data:l.readFile("video"),mime:a.mime},l.unlink("video")),u&&(d={data:l.readFile("audio"),mime:u.mime},l.unlink("audio")),[2,{audioChunk:d,videoChunk:p}]}}))}))},e.prototype.runFFmpeg=function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return P(this,void 0,void 0,(function(){var r,o,i;return C(this,(function(a){switch(a.label){case 0:r=function(t,e){var n=t._malloc(e.length*Uint32Array.BYTES_PER_ELEMENT);return e.forEach((function(e,r){var o=t.lengthBytesUTF8(e)+1,i=t._malloc(o);t.stringToUTF8(e,i,o),t.setValue(n+Uint32Array.BYTES_PER_ELEMENT*r,i,"i32")})),[e.length,n]},console.log("Running ffmpeg",n),this.ffmpegState=F.Busy,a.label=1;case 1:return a.trys.push([1,3,,4]),o=this,[4,createFFmpegCore({locateFile:function(e,n){return e.endsWith("ffmpeg-core.wasm")?"/includes/ffmpeg-core.wasm":e.endsWith("ffmpeg-core.worker.js")?t:n+e},printErr:function(t){return console.log(t)},print:function(t){return console.log(t)}})];case 2:return o.ffmpegCore=a.sent(),this.ffmpegMain=this.ffmpegCore.cwrap("main","number",["number","number"]),this.ffmpegCore.FS.writeFile("input.mkv",this.buf),this.ffmpegMain.apply(this,r(this.ffmpegCore,e.defaultArgs.concat(n))),[3,4];case 3:return 0==(i=a.sent()).status?this.ffmpegState=F.Idle:console.error("Exception caught from entrypoint: ",i),[3,4];case 4:return[2]}}))}))},e.defaultArgs=["ffmpeg","-hide_banner","-nostdin"],e.streamRegex=/\s*Stream #(?<id>\d+:\d+)\(?(?<lang>.*?)\)?: (?<type>\w+): (?<formatDescription>.*)/,e.durationRegex=/Duration: (\d+?):(\d{2}):(.+?),/,e}();const D=N,L=Symbol("Comlink.proxy"),U=Symbol("Comlink.endpoint"),R=Symbol("Comlink.releaseProxy"),z=Symbol("Comlink.thrown"),I=t=>"object"==typeof t&&null!==t||"function"==typeof t,W=new Map([["proxy",{canHandle:t=>I(t)&&t[L],serialize(t){const{port1:e,port2:n}=new MessageChannel;return H(t,e),[n,[n]]},deserialize:t=>(t.start(),G(t,[],undefined))}],["throw",{canHandle:t=>I(t)&&z in t,serialize({value:t}){let e;return e=t instanceof Error?{isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:{isError:!1,value:t},[e,[]]},deserialize(t){if(t.isError)throw Object.assign(new Error(t.value.message),t.value);throw t.value}}]]);function H(t,e=self){e.addEventListener("message",(function n(r){if(!r||!r.data)return;const{id:o,type:i,path:a}=Object.assign({path:[]},r.data),s=(r.data.argumentList||[]).map(J);let u;try{const e=a.slice(0,-1).reduce(((t,e)=>t[e]),t),n=a.reduce(((t,e)=>t[e]),t);switch(i){case"GET":u=n;break;case"SET":e[a.slice(-1)[0]]=J(r.data.value),u=!0;break;case"APPLY":u=n.apply(e,s);break;case"CONSTRUCT":u=function(t){return Object.assign(t,{[L]:!0})}(new n(...s));break;case"ENDPOINT":{const{port1:e,port2:n}=new MessageChannel;H(t,n),u=function(t,e){return q.set(t,e),t}(e,[e])}break;case"RELEASE":u=void 0;break;default:return}}catch(t){u={value:t,[z]:0}}Promise.resolve(u).catch((t=>({value:t,[z]:0}))).then((t=>{const[r,a]=X(t);e.postMessage(Object.assign(Object.assign({},r),{id:o}),a),"RELEASE"===i&&(e.removeEventListener("message",n),B(e))}))})),e.start&&e.start()}function B(t){(function(t){return"MessagePort"===t.constructor.name})(t)&&t.close()}function Y(t){if(t)throw new Error("Proxy has been released and is not useable")}function G(t,e=[],n=function(){}){let r=!1;const o=new Proxy(n,{get(n,i){if(Y(r),i===R)return()=>K(t,{type:"RELEASE",path:e.map((t=>t.toString()))}).then((()=>{B(t),r=!0}));if("then"===i){if(0===e.length)return{then:()=>o};const n=K(t,{type:"GET",path:e.map((t=>t.toString()))}).then(J);return n.then.bind(n)}return G(t,[...e,i])},set(n,o,i){Y(r);const[a,s]=X(i);return K(t,{type:"SET",path:[...e,o].map((t=>t.toString())),value:a},s).then(J)},apply(n,o,i){Y(r);const a=e[e.length-1];if(a===U)return K(t,{type:"ENDPOINT"}).then(J);if("bind"===a)return G(t,e.slice(0,-1));const[s,u]=V(i);return K(t,{type:"APPLY",path:e.map((t=>t.toString())),argumentList:s},u).then(J)},construct(n,o){Y(r);const[i,a]=V(o);return K(t,{type:"CONSTRUCT",path:e.map((t=>t.toString())),argumentList:i},a).then(J)}});return o}function V(t){const e=t.map(X);return[e.map((t=>t[0])),(n=e.map((t=>t[1])),Array.prototype.concat.apply([],n))];var n}const q=new WeakMap;function X(t){for(const[e,n]of W)if(n.canHandle(t)){const[r,o]=n.serialize(t);return[{type:"HANDLER",name:e,value:r},o]}return[{type:"RAW",value:t},q.get(t)||[]]}function J(t){switch(t.type){case"HANDLER":return W.get(t.name).deserialize(t.value);case"RAW":return t.value}}function K(t,e,n){return new Promise((r=>{const o=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");t.addEventListener("message",(function e(n){n.data&&n.data.id&&n.data.id===o&&(t.removeEventListener("message",e),r(n.data))})),t.start&&t.start(),t.postMessage(Object.assign({id:o},e),n)}))}H(new D)})(),{}})()}));
//# sourceMappingURL=767.js.map